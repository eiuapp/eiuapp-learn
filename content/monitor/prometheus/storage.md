# storage

## 本地存储

每两个小时的数据存储在一个目录中，包含一个或者多个块文件，里面也有这个时间区间的所有时间序列样本，以及元数据文件和索引文件（通过metric name和label索引时间序列）。当前时间段的数据并没有直接持久化到本地，而是存放在内存中。有一个WAL（write-ahead-log）预写日志机制，当Prometheus服务从崩溃中重启时可以重放WAL日志。当时间序列数据通过API被删除时，只是把删除记录保存在单独的逻辑删除文件中，而不是立即从块文件中删除数据

最初的两小时一个的时间序列会在后期被不断压缩并整合成一个长时间序列（类似zabbix保留趋势数据的方式？减小时间精度之类）

## 参数

* `--storage.tsdb.path`: 数据存储目录，默认为`data/`
* `--storage.tsdb.retention`：数据保留时间，默认为15d

## 远程存储

本地存储不支持多节点

http2